{% extends "base.html" %}

{% block title %}Novo Brief - EazyBrief{% endblock %}

{% block page_title %}Criar Novo Brief{% endblock %}

{% block extra_css %}
<style>
    .input-section { display: none; }
    .input-section.active { display: block; }
    .input-type-btn.active { background: #eef2ff; border-color: #6366f1; color: #3730a3; }
    .fade-in {
        animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
</style>
{% endblock %}

{% block extra_js %}
<!-- Biblioteca Marked para renderizar markdown no preview -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
console.log('Script do new_brief carregado com sucesso.');

// Funções auxiliares
function showBriefPreview(html) {
    const briefResult = document.getElementById('brief-result');
    const resultSection = document.getElementById('result-section');
    const briefActions = document.getElementById('brief-actions');
    const briefHint = document.getElementById('brief-hint');

    if (briefResult && resultSection && briefActions && briefHint) {
        briefResult.innerHTML = html;
        resultSection.classList.remove('hidden');
        briefActions.classList.remove('hidden');
        briefHint.classList.remove('hidden');
        resultSection.scrollIntoView({ behavior: 'smooth' });
    } else {
        console.error('Erro: Um ou mais elementos de resultado não encontrados.');
    }
}

function editBrief() {
    const resultSection = document.getElementById('result-section');
    const briefActions = document.getElementById('brief-actions');
    const briefHint = document.getElementById('brief-hint');
    const briefForm = document.getElementById('brief-form');

    if (resultSection && briefActions && briefHint && briefForm) {
        resultSection.classList.add('hidden');
        briefActions.classList.add('hidden');
        briefHint.classList.add('hidden');
        briefForm.style.display = '';
    } else {
        console.error('Erro: Um ou mais elementos de edição não encontrados.');
    }
}

function cancelBrief() {
    const resultSection = document.getElementById('result-section');
    const briefActions = document.getElementById('brief-actions');
    const briefHint = document.getElementById('brief-hint');
    const briefForm = document.getElementById('brief-form');
    const briefText = document.getElementById('brief-text');
    const briefResult = document.getElementById('brief-result');

    if (resultSection && briefActions && briefHint && briefForm && briefText && briefResult) {
        resultSection.classList.add('hidden');
        briefActions.classList.add('hidden');
        briefHint.classList.add('hidden');
        briefForm.style.display = '';
        briefText.value = '';
        briefResult.innerHTML = '';
    } else {
        console.error('Erro: Um ou mais elementos de cancelamento não encontrados.');
    }
}

function saveBrief() {
    const briefForm = document.getElementById('brief-form');
    if (briefForm) {
        briefForm.submit();
    } else {
        console.error('Erro: Formulário de brief não encontrado.');
    }
}

// Funções de tipo de entrada
function switchInputType(type) {
    console.log('Mudando para tipo:', type);

    const buttons = document.querySelectorAll('.input-type-btn');
    const sections = document.querySelectorAll('.input-section');

    buttons.forEach(btn => btn.classList.remove('active'));
    sections.forEach(section => section.classList.remove('active'));

    const button = document.querySelector(`.input-type-btn[data-input-type="${type}"]`);
    const inputSection = document.getElementById(`${type}-input`);

    if (button && inputSection) {
        button.classList.add('active');
        inputSection.classList.add('active');
    } else {
        console.error(`Erro: Botão ou seção para o tipo "${type}" não encontrados.`);
    }
}

// Funções de upload e preview
function handleImageUpload(input) {
    const file = input.files[0];
    const imagePreview = document.getElementById('imagePreview');
    const imagePreviewImg = document.getElementById('imagePreviewImg');
    const imagePreviewName = document.getElementById('imagePreviewName');

    if (file && imagePreview && imagePreviewImg && imagePreviewName) {
        const reader = new FileReader();
        reader.onload = function(e) {
            imagePreviewImg.src = e.target.result;
            imagePreview.classList.remove('hidden');
            imagePreviewName.textContent = file.name;
        };
        reader.readAsDataURL(file);
    } else {
        console.error('Erro: Arquivo ou elementos de preview de imagem não encontrados.');
    }
}

function removeImage() {
    const imageFile = document.getElementById('imageFile');
    const imagePreview = document.getElementById('imagePreview');
    const imagePreviewImg = document.getElementById('imagePreviewImg');
    const imagePreviewName = document.getElementById('imagePreviewName');

    if (imageFile && imagePreview && imagePreviewImg && imagePreviewName) {
        imageFile.value = '';
        imagePreviewImg.src = '';
        imagePreview.classList.add('hidden');
        imagePreviewName.textContent = '';
    } else {
        console.error('Erro: Elementos de remoção de imagem não encontrados.');
    }
}

function handleAudioUpload(input) {
    const file = input.files[0];
    const audioPreview = document.getElementById('audioPreview');

    if (file && audioPreview) {
        const audioElement = audioPreview.querySelector('audio');
        if (audioElement) {
            audioElement.src = URL.createObjectURL(file);
            audioPreview.classList.remove('hidden');
        } else {
            console.error('Erro: Elemento de áudio não encontrado.');
        }
    } else {
        console.error('Erro: Arquivo ou elemento de preview de áudio não encontrados.');
    }
}

function removeAudio() {
    const audioFile = document.getElementById('audioFile');
    const audioPreview = document.getElementById('audioPreview');

    if (audioFile && audioPreview) {
        audioFile.value = '';
        const audioElement = audioPreview.querySelector('audio');
        if (audioElement) {
            audioElement.src = '';
            audioPreview.classList.add('hidden');
        } else {
            console.error('Erro: Elemento de áudio não encontrado.');
        }
    } else {
        console.error('Erro: Elementos de remoção de áudio não encontrados.');
    }
}

// Função para gravação de áudio (básica)
function startAudioRecording() {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert('Gravação de áudio não é suportada neste navegador.');
        return;
    }

    alert('Funcionalidade de gravação de áudio em desenvolvimento. Por favor, use a opção "Enviar" para fazer upload de um arquivo de áudio.');
    // Para uma implementação futura, você pode usar a API MediaRecorder:
    /*
    navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
            const mediaRecorder = new MediaRecorder(stream);
            // Implementar lógica de gravação aqui
        })
        .catch(err => {
            console.error('Erro ao acessar o microfone:', err);
            alert('Erro ao acessar o microfone. Verifique as permissões.');
        });
    */
}

// Funções de campos extras
let extraFieldId = 0;

function addExtraField() {
    console.log('Adicionando campo extra...');
    extraFieldId++;
    const container = document.createElement('div');
    container.className = 'flex space-x-2 items-center fade-in';
    container.id = `extra-field-${extraFieldId}`;
    container.innerHTML = `
        <input type="text" placeholder="Nome do campo (ex: Data de Entrega)" class="extra-field-name p-2 border border-indigo-200 rounded-lg w-1/3 focus:ring-2 focus:ring-indigo-400" />
        <input type="text" placeholder="Valor" class="extra-field-value p-2 border border-indigo-200 rounded-lg w-2/3 focus:ring-2 focus:ring-indigo-400" />
        <button type="button" class="remove-extra-field text-red-500 hover:text-red-700 text-lg" title="Remover"><i class="fas fa-times"></i></button>
    `;
    const extraFields = document.getElementById('extra-fields');
    if (extraFields) {
        extraFields.appendChild(container);
        const removeBtn = container.querySelector('.remove-extra-field');
        if (removeBtn) {
            removeBtn.addEventListener('click', () => container.remove());
        }
    } else {
        console.error('Erro: Elemento #extra-fields não encontrado.');
    }
}

// Funções de geração e limpeza
async function generateBrief() {
    console.log('Gerando brief...');

    const briefText = document.getElementById('brief-text');
    const briefType = document.getElementById('brief-type');
    const template = document.getElementById('brief-template');
    const model = document.getElementById('model-select');

    if (!briefText || !briefType || !template || !model) {
        console.error('Erro: Um ou mais elementos do formulário não encontrados.');
        alert('Erro: Um ou mais elementos do formulário não encontrados.');
        return;
    }

    const briefTextValue = briefText.value;
    const briefTypeValue = briefType.value;
    const templateValue = template.value;
    const modelValue = model.value;

    console.log('Dados coletados:', { briefTypeValue, templateValue, modelValue });

    const extraFieldsContainer = document.getElementById('extra-fields');
    if (!extraFieldsContainer) {
        console.error('Erro: Elemento #extra-fields não encontrado.');
        return;
    }

    const extraFields = Array.from(extraFieldsContainer.querySelectorAll('div')).map(div => {
        const nameInput = div.querySelector('.extra-field-name');
        const valueInput = div.querySelector('.extra-field-value');
        if (nameInput && valueInput) {
            const name = nameInput.value.trim();
            const value = valueInput.value.trim();
            return name && value ? { name, value } : null;
        }
        return null;
    }).filter(Boolean);

    const activeInputTypeElement = document.querySelector('.input-type-btn.active');
    if (!activeInputTypeElement) {
        console.error('Erro: Nenhum tipo de entrada ativo encontrado.');
        alert('Por favor, selecione um tipo de entrada (texto, áudio ou imagem).');
        return;
    }
    const activeInputType = activeInputTypeElement.getAttribute('data-input-type');
    console.log('Tipo de entrada ativo:', activeInputType);

    let formData = new FormData();
    formData.append('type', briefTypeValue);
    formData.append('template', templateValue);
    formData.append('extras', JSON.stringify(extraFields));
    formData.append('model', modelValue);

    try {
        if (activeInputType === 'text') {
            if (!briefTextValue) {
                alert('Por favor, insira um texto para gerar o briefing.');
                return;
            }
            formData.append('text', briefTextValue);
        } else if (activeInputType === 'audio') {
            const audioFileInput = document.getElementById('audioFile');
            if (!audioFileInput || !audioFileInput.files[0]) {
                alert('Por favor, selecione um arquivo de áudio.');
                return;
            }
            formData.append('audio', audioFileInput.files[0]);
        } else if (activeInputType === 'image') {
            const imageFileInput = document.getElementById('imageFile');
            if (!imageFileInput || !imageFileInput.files[0]) {
                alert('Por favor, selecione uma imagem.');
                return;
            }
            const imageDataUrl = await new Promise(resolve => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.readAsDataURL(imageFileInput.files[0]);
            });
            formData.append('image', imageDataUrl);
        }

        const generateBtn = document.getElementById('generateBtn');
        if (generateBtn) {
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Gerando...';
        }

        const briefResult = document.getElementById('brief-result');
        const resultSection = document.getElementById('result-section');
        if (briefResult && resultSection) {
            briefResult.innerHTML = '';
            resultSection.classList.add('hidden');
        }

        console.log('Enviando requisição para /api/generate-brief');
        const response = await fetch('/api/generate-brief', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();
        console.log('Resposta recebida:', data);

        if (data.result && data.html) {
            const briefTypeOption = document.querySelector(`#brief-type option[value="${briefTypeValue}"]`);
            const briefTypeText = briefTypeOption ? briefTypeOption.textContent : briefTypeValue;
            showBriefPreview(`<h3 class='text-xl font-semibold mb-4'>Briefing de ${briefTypeText}</h3>` + data.html);
        } else {
            if (briefResult && resultSection) {
                briefResult.innerHTML = `<span class='text-red-600'>Erro: ${data.error || 'Falha ao gerar briefing.'}</span>`;
                resultSection.classList.remove('hidden');
            }
        }
    } catch (err) {
        console.error('Erro ao gerar brief:', err);
        if (briefResult && resultSection) {
            briefResult.innerHTML = `<span class='text-red-600'>Erro de conexão com o servidor.</span>`;
            resultSection.classList.remove('hidden');
        }
    } finally {
        if (generateBtn) {
            generateBtn.disabled = false;
            generateBtn.innerHTML = '<i class="fas fa-magic mr-2"></i>Gerar Briefing';
        }
    }
}

function clearForm() {
    console.log('Limpando formulário...');

    const textareas = document.querySelectorAll('textarea');
    const fileInputs = document.querySelectorAll('input[type="file"]');
    const extraFields = document.getElementById('extra-fields');
    const imagePreview = document.getElementById('imagePreview');
    const audioPreview = document.getElementById('audioPreview');
    const resultSection = document.getElementById('result-section');

    if (textareas) textareas.forEach(input => input.value = '');
    if (fileInputs) fileInputs.forEach(input => input.value = '');
    if (extraFields) extraFields.innerHTML = '';
    if (imagePreview) imagePreview.classList.add('hidden');
    if (audioPreview) audioPreview.classList.add('hidden');
    if (resultSection) resultSection.classList.add('hidden');

    const buttons = document.querySelectorAll('.input-type-btn');
    const sections = document.querySelectorAll('.input-section');
    buttons.forEach(btn => btn.classList.remove('active'));
    sections.forEach(section => section.classList.remove('active'));

    const textBtn = document.querySelector('.input-type-btn[data-input-type="text"]');
    const textSection = document.getElementById('text-input');
    if (textBtn && textSection) {
        textBtn.classList.add('active');
        textSection.classList.add('active');
    } else {
        console.error('Erro: Elementos de texto padrão não encontrados.');
    }
}

function copyResult() {
    const briefResult = document.getElementById('brief-result');
    if (briefResult) {
        const range = document.createRange();
        range.selectNode(briefResult);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
        const copyBtn = document.getElementById('copyBtn');
        if (copyBtn) {
            copyBtn.innerHTML = '<i class="fas fa-check mr-1"></i>Copiado!';
            setTimeout(() => { copyBtn.innerHTML = '<i class="far fa-copy"></i>'; }, 1500);
        }
    } else {
        console.error('Erro: Elemento de resultado não encontrado para cópia.');
    }
}

function shareWhatsApp() {
    const briefResult = document.getElementById('brief-result');
    if (briefResult) {
        const text = encodeURIComponent(briefResult.innerText);
        window.open(`https://wa.me/?text=${text}`, '_blank');
    } else {
        console.error('Erro: Elemento de resultado não encontrado para compartilhamento.');
    }
}

// Inicialização
document.addEventListener('DOMContentLoaded', function() {
    console.log('Página carregada - Inicializando...');

    // Ativar texto por padrão
    const textBtn = document.querySelector('.input-type-btn[data-input-type="text"]');
    const textSection = document.getElementById('text-input');
    if (textBtn && textSection) {
        textBtn.classList.add('active');
        textSection.classList.add('active');
    } else {
        console.error('Erro: Elementos de inicialização de texto não encontrados.');
    }

    // Associar eventos aos botões de tipo de entrada
    const inputTypeButtons = document.querySelectorAll('.input-type-btn');
    inputTypeButtons.forEach(button => {
        button.addEventListener('click', () => {
            const type = button.getAttribute('data-input-type');
            console.log('Botão de tipo de entrada clicado:', type);
            switchInputType(type);
        });
    });

    // Associar evento ao botão de adicionar campo extra
    const addExtraFieldBtn = document.querySelector('.add-extra-field-btn');
    if (addExtraFieldBtn) {
        addExtraFieldBtn.addEventListener('click', () => {
            console.log('Botão Adicionar Campo Extra clicado');
            addExtraField();
        });
    } else {
        console.error('Erro: Botão .add-extra-field-btn não encontrado.');
    }

    // Associar evento ao botão de gerar briefing
    const generateBtn = document.getElementById('generateBtn');
    if (generateBtn) {
        generateBtn.addEventListener('click', () => {
            console.log('Botão Gerar Briefing clicado');
            generateBrief();
        });
    } else {
        console.error('Erro: Botão #generateBtn não encontrado.');
    }

    // Associar evento ao botão de limpar
    const clearBtn = document.getElementById('clearBtn');
    if (clearBtn) {
        clearBtn.addEventListener('click', () => {
            console.log('Botão Limpar clicado');
            clearForm();
        });
    } else {
        console.error('Erro: Botão #clearBtn não encontrado.');
    }

    // Associar eventos aos botões de áudio
    const audioRecordBtn = document.querySelector('.audio-record-btn');
    const audioUploadBtn = document.querySelector('.audio-upload-btn');
    if (audioRecordBtn) {
        audioRecordBtn.addEventListener('click', () => {
            console.log('Botão Gravar Áudio clicado');
            startAudioRecording();
        });
    } else {
        console.error('Erro: Botão .audio-record-btn não encontrado.');
    }
    if (audioUploadBtn) {
        audioUploadBtn.addEventListener('click', () => {
            console.log('Botão Enviar Áudio clicado');
            const audioFileInput = document.getElementById('audioFile');
            if (audioFileInput) {
                audioFileInput.click();
            } else {
                console.error('Erro: Input #audioFile não encontrado.');
            }
        });
    } else {
        console.error('Erro: Botão .audio-upload-btn não encontrado.');
    }

    // Associar evento ao botão de upload de imagem
    const imageUploadBtn = document.querySelector('.image-upload-btn');
    if (imageUploadBtn) {
        imageUploadBtn.addEventListener('click', () => {
            console.log('Botão Selecionar Imagem clicado');
            const imageFileInput = document.getElementById('imageFile');
            if (imageFileInput) {
                imageFileInput.click();
            } else {
                console.error('Erro: Input #imageFile não encontrado.');
            }
        });
    } else {
        console.error('Erro: Botão .image-upload-btn não encontrado.');
    }
});
</script>
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
  <div class="bg-gradient-to-br from-indigo-50 to-white rounded-2xl shadow-xl p-8 mb-8 border border-indigo-100 animate-fade-in">
    <!-- Etapas e template -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8">
      <div class="flex items-center space-x-3 mb-4 md:mb-0">
        <span class="inline-flex items-center px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs font-bold">
          <i class="fas fa-robot mr-1"></i> Modelo:
          <select id="model-select" class="ml-2 bg-transparent border-none focus:ring-0 text-indigo-700">
            <option value="groq">Groq (Llama)</option>
            <option value="gemini">Gemini (Google)</option>
          </select>
        </span>
        <span class="inline-flex items-center px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-bold"><i class="fas fa-rocket mr-1"></i> Passo 1</span>
        <span class="inline-flex items-center px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs font-bold"><i class="fas fa-palette mr-1"></i> Template: <select id="brief-template" class="ml-2 bg-transparent border-none focus:ring-0 text-indigo-700">
          <option value="classic">Clássico</option>
          <option value="visual">Visual</option>
          <option value="minimal">Minimalista</option>
        </select></span>
      </div>
      <button type="button" class="add-extra-field-btn inline-flex items-center px-4 py-2 bg-white border border-indigo-200 text-indigo-700 rounded-md shadow-sm hover:bg-indigo-50 transition"><i class="fas fa-plus mr-2"></i>Adicionar Campo Extra</button>
    </div>
    <form id="brief-form" autocomplete="off">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Input Type Selector -->
        <div class="bg-indigo-50 p-4 rounded-xl shadow flex flex-col items-stretch">
          <h3 class="font-semibold mb-3 text-indigo-700">Tipo de Entrada</h3>
          <div class="space-y-2">
            <button type="button" data-input-type="text" class="input-type-btn w-full text-left p-3 rounded-lg border border-indigo-200 transition flex items-center">
              <i class="fas fa-font w-6 text-center"></i>
              <span class="ml-2">Texto</span>
            </button>
            <button type="button" data-input-type="audio" class="input-type-btn w-full text-left p-3 rounded-lg border border-indigo-200 transition flex items-center">
              <i class="fas fa-microphone w-6 text-center"></i>
              <span class="ml-2">Áudio</span>
            </button>
            <button type="button" data-input-type="image" class="input-type-btn w-full text-left p-3 rounded-lg border border-indigo-200 transition flex items-center">
              <i class="fas fa-image w-6 text-center"></i>
              <span class="ml-2">Imagem</span>
            </button>
          </div>
        </div>
        <div class="md:col-span-2">
          <div id="text-input" class="input-section active">
            <label for="brief-text" class="block text-sm font-medium text-gray-700 mb-2">Cole o texto do briefing</label>
            <textarea id="brief-text" rows="6" class="w-full p-3 border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 transition"></textarea>
          </div>
          <div id="audio-input" class="input-section">
            <div class="border-2 border-dashed border-indigo-200 rounded-lg p-8 text-center">
              <i class="fas fa-microphone text-4xl text-indigo-400 mb-4"></i>
              <p class="mb-4">Grave um áudio ou faça upload de um arquivo</p>
              <div class="flex justify-center space-x-4">
                <button type="button" class="audio-record-btn px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"><i class="fas fa-microphone mr-2"></i>Gravar</button>
                <button type="button" class="audio-upload-btn px-4 py-2 bg-white border border-indigo-200 rounded-md hover:bg-indigo-50"><i class="fas fa-upload mr-2"></i>Enviar</button>
              </div>
              <input type="file" id="audioFile" accept="audio/*" class="hidden" onchange="handleAudioUpload(this)">
            </div>
            <div id="audioPreview" class="mt-4 hidden">
              <audio controls class="w-full"></audio>
              <button type="button" onclick="removeAudio()" class="mt-2 text-red-600 text-sm"><i class="fas fa-trash mr-1"></i>Remover áudio</button>
            </div>
          </div>
          <div id="image-input" class="input-section">
            <div class="border-2 border-dashed border-indigo-200 rounded-lg p-8 text-center">
              <i class="fas fa-image text-4xl text-indigo-400 mb-4"></i>
              <p class="mb-4">Arraste e solte uma imagem ou clique para selecionar</p>
              <input type="file" id="imageFile" accept="image/*" class="hidden" onchange="handleImageUpload(this)">
              <button type="button" class="image-upload-btn px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"><i class="fas fa-upload mr-2"></i>Selecionar Imagem</button>
            </div>
            <div id="imagePreview" class="hidden mt-2">
              <div class="flex items-center space-x-3 bg-white border-2 border-indigo-200 rounded-xl p-3 shadow-lg">
                <img src="" alt="Preview" class="max-h-32 rounded-xl shadow-lg border-2 border-indigo-300" id="imagePreviewImg" />
                <div class="flex flex-col">
                  <span id="imagePreviewName" class="text-xs text-gray-600"></span>
                  <button type="button" onclick="removeImage()" class="mt-2 text-red-500 hover:text-red-700"><i class="fas fa-times"></i> Remover Imagem</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Campos extras dinâmicos -->
      <div id="extra-fields" class="mt-8 space-y-4"></div>
      <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="brief-type" class="block text-sm font-medium text-gray-700 mb-2">Tipo de Briefing</label>
          <select id="brief-type" class="w-full p-3 border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 transition">
            <option value="design">Design Gráfico</option>
            <option value="marketing">Marketing Digital</option>
            <option value="development">Desenvolvimento Web</option>
            <option value="social">Mídias Sociais</option>
            <option value="video">Produção de Vídeo</option>
            <option value="custom">Personalizado</option>
          </select>
        </div>
        <div class="flex items-end justify-end space-x-4">
          <button type="button" id="generateBtn" class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-400 shadow transition"><i class="fas fa-magic mr-2"></i>Gerar Briefing</button>
          <button type="button" id="clearBtn" class="px-6 py-3 border border-indigo-200 text-indigo-700 bg-white rounded-lg hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-400 shadow transition"><i class="fas fa-eraser mr-2"></i>Limpar</button>
        </div>
      </div>
    </form>
  </div>
  <div id="result-section" class="hidden animate-fade-in">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-bold text-indigo-800">Briefing Gerado</h2>
      <div class="flex space-x-2">
        <button onclick="copyResult()" id="copyBtn" class="p-2 text-indigo-400 hover:text-indigo-700" title="Copiar"><i class="far fa-copy"></i></button>
        <button onclick="alert('Exportar para PDF em breve!')" id="downloadPdfBtn" class="p-2 text-indigo-400 hover:text-indigo-700" title="Baixar PDF"><i class="far fa-file-pdf"></i></button>
        <button onclick="alert('Exportar para DOCX em breve!')" id="downloadDocxBtn" class="p-2 text-indigo-400 hover:text-indigo-700" title="Baixar DOCX"><i class="far fa-file-word"></i></button>
        <button onclick="shareWhatsApp()" id="shareWhatsappBtn" class="p-2 text-indigo-400 hover:text-indigo-700" title="Compartilhar no WhatsApp"><i class="fab fa-whatsapp"></i></button>
      </div>
    </div>
    <div id="brief-result" class="prose prose-indigo max-w-none bg-gray-50 rounded-lg shadow-lg p-8 border border-indigo-100 text-gray-900 text-base leading-relaxed"></div>
    <div id="brief-actions" class="hidden mt-4 flex gap-4">
      <button onclick="saveBrief()" id="saveBriefBtn" class="px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-400 shadow transition"><i class="fas fa-save mr-2"></i>Salvar Brief</button>
      <button onclick="editBrief()" id="editBriefBtn" class="px-6 py-3 border border-indigo-200 text-indigo-700 bg-white rounded-lg hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-400 shadow transition"><i class="fas fa-edit mr-2"></i>Editar</button>
      <button onclick="cancelBrief()" id="cancelBriefBtn" class="px-6 py-3 border border-red-200 text-red-700 bg-white rounded-lg hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-400 shadow transition"><i class="fas fa-times mr-2"></i>Cancelar</button>
    </div>
    <div id="brief-hint" class="hidden mt-2 text-sm text-gray-500">Revise e edite seu briefing antes de salvar. Se não gostou, clique em editar ou cancelar.</div>
  </div>
</div>
{% endblock %}